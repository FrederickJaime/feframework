const { src, dest } = require('gulp');
const postcss = require('gulp-postcss');
const sass = require('gulp-sass');
const sourcemaps = require('gulp-sourcemaps');
const autoprefixer = require('autoprefixer');
const cssnano = require('cssnano');
const argv = require('yargs').argv;
const isMVP = (argv.mvp === undefined) ? false : true;
const config = require('../config');

export function sassMinCompile() {
  let plugins = [
    autoprefixer({ browsers: ['last 2 version'] }),
    cssnano(),

  ];
  let frameworkBuild = isMVP ? `${config.css.scssDir}/sxm.mvp.phoenix.scss` : `${config.css.scssDir}/sxm.phoenix.scss`;

  return src(frameworkBuild)
  .pipe(sourcemaps.init())
  .pipe(sass({ outputStyle: 'compressed' }).on('error',sass.logError))
  .pipe(postcss(plugins))
  .pipe(sourcemaps.write('.'))
  .pipe(dest(`${config.local.appcss}`))
  .pipe(dest(`${config.css.distDirMin}`));
  
}
